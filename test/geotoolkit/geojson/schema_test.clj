(ns geotoolkit.geojson.schema_test
  (:use clojure.test)
  (:require
    [schema.core :as s]
    [geotoolkit.geojson.schema :as schema]
  ))


(def tg-point {
  :properties {
    :id 1,
    :title "sdfscsd sdfsfd"},
  :geometry {
      :coordinates [3.0 34.0],
      :type "Point" },
  :type "Feature"})
  
(def tg-line {
  :properties {
    :id 4,
    :title "linie"},
  :geometry {
    :coordinates '([4.0 5.0] [9.0 3.0]),
    :type "LineString"},
  :type "Feature"})
 
(def tg-polygon {
  :properties {
    :id 5,
    :title "polygon"},
  :geometry {
    :coordinates ['([9.742781352708207 4.856953381770519]
          [10.396865782776064 4.431351104694237] [10.64926814637864 4.131333099197917] [10.838290060036117 3.7878385971583337]
          [10.956667517611347 3.4140678996549307] [10.99985133979656 3.024384804979742] [10.966181996522945 2.6337646159243384]
          [10.856953381770518 2.2572186472917926] [10.676363089948106 1.9092173494872415] [10.431351104694238 1.6031342172239378]
          [10.13133309919792 1.3507318536213617] [9.787838597158336 1.1617099399638848] [9.414067899654935 1.0433324823886527]
          [9.024384804979745 1.000148660203439] [8.633764615924342 1.0338180034770548] [8.257218647291793 1.1430466182294812]
          [3.2572186472917926 3.143046618229481] [2.909217349487239 3.3236369100518957] [2.6031342172239347 3.5686488953057633]
          [2.35073185362136 3.868666900802083] [2.1617099399638833 4.212161402841667] [2.043332482388652 4.58593210034507]
          [2.000148660203439 4.975615195020258] [2.033818003477055 5.366235384075662] [2.1430466182294814 5.742781352708207]
          [2.3236369100518943 6.090782650512759] [2.5686488953057607 6.396865782776063] [2.8686669008020798 6.649268146378638]
          [3.212161402841663 6.838290060036115] [3.585932100345066 6.956667517611347] [3.9756151950202545 6.999851339796561]
          [4.366235384075658 6.966181996522945] [4.742781352708207 6.856953381770519] [9.742781352708207 4.856953381770519])],
    :type "Polygon"},
  :type "Feature"})
  
(def tg-multi-point {
  :properties {
    :id 8,
    :title "multi point"},
  :geometry {
    :geometries '(
      {:coordinates [3.0 34.0],
        :type "Point"}
      {:coordinates [12.0 10.0],
        :type "Point"} 
      {:coordinates [7.0 4.0],
        :type "Point"}),
    :type "MultiPoint"},
  :type "Feature"})
  
(def tg-multi-polygon {
  :properties {
    :id 9,
    :title "multi poly"},
  :geometry {
    :geometries (
    {:coordinates ['([9.742781352708207 4.856953381770519] [10.838290060036117 3.7878385971583337] [10.956667517611347 3.4140678996549307]
        [10.99985133979656 3.024384804979742] [10.966181996522945 2.6337646159243384] [10.856953381770518 2.2572186472917926]
        [10.676363089948106 1.9092173494872415] [10.431351104694238 1.6031342172239378] [10.13133309919792 1.3507318536213617]
        [9.787838597158336 1.1617099399638848] [9.414067899654935 1.0433324823886527] [9.024384804979745 1.000148660203439]
        [8.633764615924342 1.0338180034770548] [8.257218647291793 1.1430466182294812] [3.2572186472917926 3.143046618229481]
        [2.1617099399638833 4.212161402841667] [2.043332482388652 4.58593210034507] [2.000148660203439 4.975615195020258]
        [2.033818003477055 5.366235384075662] [2.1430466182294814 5.742781352708207] [2.3236369100518943 6.090782650512759]
        [2.5686488953057607 6.396865782776063] [2.8686669008020798 6.649268146378638] [3.212161402841663 6.838290060036115]
        [3.585932100345066 6.956667517611347] [3.9756151950202545 6.999851339796561] [4.366235384075658 6.966181996522945]
        [4.742781352708207 6.856953381770519] [9.742781352708207 4.856953381770519])], 
      :type "Polygon"} 
    {:coordinates ['([9.371390676354103 3.9284766908852595] [9.698432891388032 3.7156755523471183] [9.82463407318932 3.5656665495989586] [9.919145030018058 3.393919298579167] [9.978333758805674 3.2070339498274656] [9.99992566989828 3.012192402489871] [9.983090998261472 2.816882307962169] [9.92847669088526 2.6286093236458963] [9.838181544974052 2.454608674743621] [9.71567555234712 2.3015671086119687] [9.56566654959896 2.175365926810681] [9.393919298579169 2.0808549699819423] [9.207033949827467 2.0216662411943265] [9.012192402489873 2.0000743301017194] [8.816882307962171 2.0169090017385276] [8.628609323645897 2.0715233091147405] [3.6286093236458963 4.071523309114741] [3.4546086747436195 4.161818455025948] [3.3015671086119673 4.284324447652882] [3.17536592681068 4.434333450401041] [3.0808549699819414 4.606080701420833] [3.021666241194326 4.792966050172534] [3.0000743301017194 4.9878075975101295] [3.0169090017385276 5.183117692037831] [3.071523309114741 5.371390676354104] [3.161818455025947 5.54539132525638] [3.2843244476528803 5.698432891388031] [3.4343334504010397 5.824634073189319] [3.6060807014208316 5.919145030018058] [3.792966050172533 5.9783337588056735] [3.9878075975101273 5.99992566989828] [4.183117692037829 5.983090998261472] [4.371390676354103 5.928476690885259] [9.371390676354103 3.9284766908852595])],
      :type "Polygon"}), 
    :type "MultiPolygon"},
  :type "Feature"})
  
(def tg-multi-line {
  :properties {
    :id 10, 
    :title "multi line"}, 
  :geometry {
    :geometries (
      {:coordinates '([4.0 5.0] [9.0 3.0]), 
        :type "LineString"}
      {:coordinates '([3.0 89.0] [1.0 19.0]),
        :type "LineString"}),
    :type "MultiLineString"},
  :type "Feature"})
  
(def tg-collection {
  :properties {
    :id 11, 
    :title "col"},
  :geometry {
    :geometries '(
      {:coordinates ([4.0 5.0] [9.0 3.0]), 
        :type "LineString"}
      {:coordinates [([9.742781352708207 4.856953381770519] [10.090782650512761 4.676363089948104] [10.396865782776064 4.431351104694237] [10.64926814637864 4.131333099197917] [10.838290060036117 3.7878385971583337] [10.956667517611347 3.4140678996549307] [10.99985133979656 3.024384804979742] [10.966181996522945 2.6337646159243384] [10.856953381770518 2.2572186472917926] [10.676363089948106 1.9092173494872415] [10.431351104694238 1.6031342172239378] [10.13133309919792 1.3507318536213617] [9.787838597158336 1.1617099399638848] [9.414067899654935 1.0433324823886527] [9.024384804979745 1.000148660203439] [8.633764615924342 1.0338180034770548] [8.257218647291793 1.1430466182294812] [3.2572186472917926 3.143046618229481] [2.909217349487239 3.3236369100518957] [2.6031342172239347 3.5686488953057633] [2.35073185362136 3.868666900802083] [2.1617099399638833 4.212161402841667] [2.043332482388652 4.58593210034507] [2.000148660203439 4.975615195020258] [2.033818003477055 5.366235384075662] [2.1430466182294814 5.742781352708207] [2.3236369100518943 6.090782650512759] [2.5686488953057607 6.396865782776063] [2.8686669008020798 6.649268146378638] [3.212161402841663 6.838290060036115] [3.585932100345066 6.956667517611347] [3.9756151950202545 6.999851339796561] [4.366235384075658 6.966181996522945] [4.742781352708207 6.856953381770519] [9.742781352708207 4.856953381770519])],
        :type "Polygon"}
      {:coordinates [([9.371390676354103 3.9284766908852595] [9.54539132525638 3.838181544974052] [9.698432891388032 3.7156755523471183] [9.82463407318932 3.5656665495989586] [9.919145030018058 3.393919298579167] [9.978333758805674 3.2070339498274656] [9.99992566989828 3.012192402489871] [9.983090998261472 2.816882307962169] [9.92847669088526 2.6286093236458963] [9.838181544974052 2.454608674743621] [9.71567555234712 2.3015671086119687] [9.56566654959896 2.175365926810681] [9.393919298579169 2.0808549699819423] [9.207033949827467 2.0216662411943265] [9.012192402489873 2.0000743301017194] [8.816882307962171 2.0169090017385276] [8.628609323645897 2.0715233091147405] [3.6286093236458963 4.071523309114741] [3.4546086747436195 4.161818455025948] [3.3015671086119673 4.284324447652882] [3.17536592681068 4.434333450401041] [3.0808549699819414 4.606080701420833] [3.021666241194326 4.792966050172534] [3.0000743301017194 4.9878075975101295] [3.0169090017385276 5.183117692037831] [3.071523309114741 5.371390676354104] [3.161818455025947 5.54539132525638] [3.2843244476528803 5.698432891388031] [3.4343334504010397 5.824634073189319] [3.6060807014208316 5.919145030018058] [3.792966050172533 5.9783337588056735] [3.9878075975101273 5.99992566989828] [4.183117692037829 5.983090998261472] [4.371390676354103 5.928476690885259] [9.371390676354103 3.9284766908852595])],
        :type "Polygon"}
      {:coordinates ([3.0 89.0] [1.0 19.0]),
        :type "LineString"}),
    :type "GeometryCollection"},
  :type "Feature"})

(def tg-polygon-hole {
  :properties {
    :id 12,
    :title "hole"},
  :geometry {
    :coordinates '(([9.503615268704731 6.723014368602035] [8.444445673950964 6.857386630623035] [8.381211668294023 6.525408100924093] [8.942413468499378 6.13019556556821] [9.898827804060614 5.893068044354681] [10.041104316788733 6.580737855873917] [10.041104316788733 6.580737855873917] [10.033200066081614 6.778344123551859] [10.033200066081614 6.778344123551859] [9.64589178143285 6.7941526249660935] [9.64589178143285 6.7941526249660935] [9.503615268704731 6.723014368602035]) ([9.582657775775909 6.493791098095622] [8.974030471327847 6.636067610823741] [8.950317719206495 6.359418836074623] [9.701221536382674 6.13019556556821] [9.701221536382674 6.13019556556821] [9.788168294160966 6.430557092438681] [9.788168294160966 6.430557092438681] [9.788168294160966 6.430557092438681] [9.582657775775909 6.493791098095622])), 
    :type "Polygon"},
  :type "Feature"}) 

(def tf-featurecollection {
  :type "FeatureCollection"
  :features [tg-collection tg-point tg-line]})

(deftest point 
  (s/validate schema/Feature tg-point))

(deftest line 
  (s/validate schema/Feature tg-line))

(deftest polygon
  (s/validate schema/Feature tg-polygon))

(deftest polygon-hole
  (s/validate schema/Feature tg-polygon-hole))

(deftest multi-point 
  (s/validate schema/Feature tg-multi-point))

(deftest multi-line
  (s/validate schema/Feature tg-multi-line))

(deftest multi-polygon
  (s/validate schema/Feature tg-multi-polygon))

(deftest collection
  (s/validate schema/Feature tg-collection))

(deftest is-coordinate
  (s/validate schema/Coordinate '[2 3]))

(deftest is-not-coordinate
  (is (thrown-with-msg? Exception #"has at least 2 coordinate numbers"
    (s/validate schema/Coordinate '[2]))))

(deftest featurecollection
  (s/validate schema/FeatureCollection tf-featurecollection))


